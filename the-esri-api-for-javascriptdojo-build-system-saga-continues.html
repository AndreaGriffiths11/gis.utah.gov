<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>The ESRI API for JavaScript/Dojo Build System Saga Continues...</title>
  <meta name="description" content="That's right, my entire app JS is in this one file *including @ESRI modules* http://t.co/06S4KCtkuR cc @DavidSpriggs @derekswingley— Scott Davis (@ScottAGRC)...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="//the-esri-api-for-javascriptdojo-build-system-saga-continues">
  <link rel="alternate" type="application/rss+xml" title="Utah Mapping Portal" href="//feed.xml" />
</head>


  <body>

    <header id="header">
  <div class="inner">
    <div id="logo">
      <a href="/">
        <img class="ie_png" src="/images/agrc_logo.png" alt="Utah Mapping Portal" />
      </a>
    </div>
    <div id="top_area">
    </div>
    <nav id="navigation">
      <ul id="menu-main-menu" class="menu">
        <li class="menu-item"><a href="/agrc-newsletter">News</a>
        </li>
        <li class="menu-item"><a href="/data">Data</a>
        </li>
        <li class="menu-item"><a href="/developer">Developer</a>
        </li>
        <li class="menu-item"><a href="/about">About</a>
        </li>
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">The ESRI API for JavaScript/Dojo Build System Saga Continues...</h1>
  </header>

  <article class="post-content">
    <blockquote class="twitter-tweet">
That's right, my entire app JS is in this one file *including <a href="https://twitter.com/Esri">@ESRI</a> modules* <a href="http://t.co/06S4KCtkuR">http://t.co/06S4KCtkuR</a> cc <a href="https://twitter.com/DavidSpriggs">@DavidSpriggs</a> <a href="https://twitter.com/derekswingley">@derekswingley</a><br />
— Scott Davis (@ScottAGRC) <a href="https://twitter.com/ScottAGRC/statuses/336948454968418305">May 21, 2013</a></p></blockquote>
<p><script async="" charset="utf-8" src="//platform.twitter.com/widgets.js"></script></p>
<p>This is my third post on this topic. First, there was <a href="http://geospatialscott.blogspot.com/2011/06/using-dojo-build-system-to-speed-up.html">discard layers</a>. Then&nbsp;<a href="http://geospatialscott.blogspot.com/2013/04/esri-jsapi-34-and-dojo-build-system.html">AMD threw a curve ball</a>. And now a little bird told me that, starting at version 3.4, there is a special build of ESRI's API for JavaScript that is straight up minified AMD modules with no layers files. I'm not sure why this hasn't been more publicized. It's just a little minification away from <a href="http://ideas.arcgis.com/ideaView?id=087E00000004JOzIAM">releasing their source code</a>d. And, as I will outline below, it allows you to build an honest-to-goodness layer file without any of the superfluous code that past versions required. This means that you can build all of the JavaScript code for your application including Dojo, ESRI and your own modules into a single, minified file.</p>
<p>To load the new AMD build of the ESRI API for JavaScript you just append "amd" onto the end of the url. For example, <a href="http://js.arcgis.com/3.6amd">js.arcgis.com/3.6amd</a>&nbsp;(3.5 requires something different because something is messed up with their build:&nbsp;<a href="http://js.arcgis.com/3.5amd/js/dojo/dojo/dojo.js">http://js.arcgis.com/3.5amd/js/dojo/dojo/dojo.js</a>). You should be able to just make this one change in your app and it should still work. You may need to explicitly require a few more ESRI modules now that you are not getting a bunch up front with their layer file. With this build you have to load each module individually. So it's going to slow down your load time significantly. It took our <a href="https://github.com/agrc/AGRCJavaScriptProjectBoilerPlate/">boilerplate</a> from 128 requests to 337 requests to load the unbuilt, source version of the app. Needless to say that you should <b>never</b>&nbsp;use this url in production! In fact, I don't even use it during development because it takes so long to load.</p>
<p>The real usefulness in the new AMD build happens when you feed it through the Dojo Build System. The first step is to scrape it to your machine. In order to do this, I needed a list of all of the ESRI modules and other resources like images and .html files. I started with their <a href="https://developers.arcgis.com/en/javascript/jsapi/argument_aliases.html">argument aliases doc</a>&nbsp;and then filled in the gaps by hand. It was easy to see what files I was missing since the build system returns errors for missing dependencies. After I had a <a href="https://github.com/agrc/AGRCJavaScriptProjectBoilerPlate/blob/master/profiles/esri_modules_3.6.txt">good list of files</a>, I used a bash script to pull the files down to my local machine. Here's the script:</p>
<p><script src="http://gist-it.appspot.com/github/agrc/AGRCJavaScriptProjectBoilerPlate/blob/master/slurp_esri_modules.sh"></script>The files cannot be fed directly into the build system as is. You'll notice that, in the script above, I had to fix some artifacts from their build (e.g.&nbsp;<code>define('dep1,dep2,dep3'.split(','))...</code>) as well as some paths to the dojo directories. After running this script you have the entire ESRI JavaScript API as separate modules that are ready for the build system. This is so ridiculously close to having the actual source code (just a bit of minification), I wonder if they are just going to <a href="http://ideas.arcgis.com/ideaView?id=087E00000004JOzIAM">release it in the future</a>.</p>
<p>After getting the ESRI modules onto your computer, it's just a matter of <a href="https://github.com/agrc/AGRCJavaScriptProjectBoilerPlate/blob/master/profiles/app.profile.js#L51">pointing to them in your build profile</a>&nbsp;and you are good to go.</p>
<p>You can see the entire set up for this process in <a href="https://github.com/agrc/AGRCJavaScriptProjectBoilerPlate/">AGRC's JavaScript Project Boilerplate</a>. Hopefully the next blog post is about how awesome it is that ESRI has finally released their source code. ;)</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Utah Mapping Portal</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Utah Mapping Portal</li>
          <li><a href="mailto:agrc@utah.gov">agrc@utah.gov</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/agrc">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">agrc</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/MapUtah">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">MapUtah</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Utah Mapping Portal | The Utah Automated Geographic Reference Center</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
