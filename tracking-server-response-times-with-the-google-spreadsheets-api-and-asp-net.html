<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Tracking Server Response Times with the Google Spreadsheets API and asp.net</title>
  <meta name="description" content="We've been noticing some speed issues with our mapserv machines recently and are trying to figure out the issue. In an effort to have a little insight into t...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="//tracking-server-response-times-with-the-google-spreadsheets-api-and-asp-net">
  <link rel="alternate" type="application/rss+xml" title="Utah Mapping Portal" href="//feed.xml" />
</head>


  <body>

    <header id="header">
  <div class="inner">
    <div id="logo">
      <a href="/">
        <img class="ie_png" src="/images/agrc_logo.png" alt="Utah Mapping Portal" />
      </a>
    </div>
    <div id="top_area">
    </div>
    <nav id="navigation">
      <ul id="menu-main-menu" class="menu">
        <li class="menu-item"><a href="/agrc-newsletter">News</a>
        </li>
        <li class="menu-item"><a href="/data">Data</a>
        </li>
        <li class="menu-item"><a href="/developer">Developer</a>
        </li>
        <li class="menu-item"><a href="/about">About</a>
        </li>
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Tracking Server Response Times with the Google Spreadsheets API and asp.net</h1>
  </header>

  <article class="post-content">
    <p>We've been noticing some speed issues with our mapserv machines recently and are trying to figure out the issue. In an effort to have a little insight into the when, where, and why's, we created a very rudimentary tracking tool that has quite a bit of potential and was fun to make. This will hopefully give us and our hosting and networking groups a better idea of what could be the root cause.</p>
<p>The abridged version of what we did was to create a console application scheduled to run every 30 minutes to request a page and report the response times to a google spreadsheet. We then created a chart in the spreadsheet that can be published on our wiki and visually consulted.</p>
<p>Google makes it really easy to use their <a href="https://developers.google.com/google-apps/app-apis" title="google app apis">app API's</a>. They've developed <a href="http://nuget.org/packages?q=gdata" title="Google.GData">asp.net assemblies</a> that you can import via <a href="http://nuget.org" title="nuget package manager">NuGet</a> to get up and running quickly. Pair that with the <a href="https://developers.google.com/google-apps/spreadsheets" title="spreadsheet api documentation">documentation</a> and <a href="https://developers.google.com/google-apps/spreadsheets/#adding_a_list_row" title="tutorials">tutorials</a> and it's really easy to get started. The NuGet package that I used for this example is the <a href="http://nuget.org/packages/Google.GData.Spreadsheets" title="nuget package">Google.GData.Spreadsheets</a>. My packages.config is below in the gist.</p>
<p>The first speed bump I encountered was choosing how to <a href="https://developers.google.com/accounts/docs/GettingStarted" title="authentication documentation">authenticate</a> my application. Google recommends OAuth2 but that doesn't really fit my needs as far as I understand. I want this application to run on my behalf without any human interaction necessary to authorize it. I chose to use <a href="https://developers.google.com/accounts/docs/AuthForInstalledApps" title="clientlogin documentation">ClientLogin</a> even though it is <a href="https://developers.google.com/accounts/terms" title="deprecation policy">deprecated</a>.</p>
<p><a href="https://developers.google.com/google-apps/spreadsheets/#authorizing_requests_with_clientlogin" title="client login example">ClientLogin</a> is pretty simple and allowed me access to my Google Drive documents in a few minutes.</p>
<p>Next I created a Spreadsheet through a browser to capture the data on our page response times. I named this document something useful so I could query for it through the SpreadSheetFeed. I also created a <a href="https://developers.google.com/google-apps/spreadsheets/#working_with_list-based_feeds" title="header row">header row</a> of values so when I insert rows, the data would map to the correct cell. If you do not create a header row you will get a 400 bad request responses when trying to insert. Therefore, if you wanted to create your spreadsheet via code, you'd have to use the Cell feed to create the header row, then use the spreadsheet feed to insert your values. For the sake of speed, I created the sheet and the header row manually. This gotcha was the only non trivial step when using this API. The error message was not very helpful and the documentation wasn't super clear.</p>
<p>After that, I was able to create a chart through the browser and publish it. It gives you a script tag you can inject or an image you can place to view online that is always up to date.</p>
<p>[image source_type="url" source_title="scatter chart" source_value="https://docs.google.com/a/utah.gov/spreadsheet/oimg?key=0AjQ5lAz8kBCAdDBfV3d3cnVwaGlkWkpHbG5PUE1vV0E&oid=4&zx=tojc5bs5kzsd" align="center"] </p>
<h3>Sample Code</h3>
<p><script src="https://gist.github.com/3954301.js"> </script></p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Utah Mapping Portal</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Utah Mapping Portal</li>
          <li><a href="mailto:agrc@utah.gov">agrc@utah.gov</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/agrc">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">agrc</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/MapUtah">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">MapUtah</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Utah Mapping Portal | The Utah Automated Geographic Reference Center</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
